/*!
 * translator.js v0.6.4
 * https://github.com/Selection-Translator/translation.js
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("blueimp-md5")):"function"==typeof define&&define.amd?define(["exports","blueimp-md5"],e):e(t.tjs={},t.md5)}(this,function(t,e){"use strict";function n(t,e){function n(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function r(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}function o(t,e,n){if(null==t)return n;"string"==typeof e&&(e=[e]);for(var r=t,o=0;o<e.length;o+=1)if(null==(r=r[e[o]]))return n;return r}function a(t){return"string"==typeof t?{text:t}:t}function u(t){if(!t)return"";var e=[];for(var n in t)!function(n){var r=[].concat(t[n]);e.push.apply(e,r.map(function(t){return n+"="+encodeURIComponent(t)}))}(n);return e.join("&")}function i(t){var e=a(t).text;return _({method:"post",url:x+"/langdetect",body:{query:e.slice(0,73)},type:"form"}).then(function(t){if(0===t.error){var e=U[t.lan];if(e)return e}throw new R("UNSUPPORTED_LANG","百度翻译不支持这个语种")})}function c(t,e){return x+"/gettts?lan="+e+"&text="+encodeURIComponent(t)+"&spd=3&source=web"}function s(t){var n=Date.now()+parseInt(String(10*Math.random()),10);return{client:A,salt:n,sign:e(A+t+n+j)}}function f(t){var e=a(t),n=e.text,r=e.from,o=e.to;return n=n.slice(0,5e3),r=r?T[r]:"AUTO",o=o?T[o]:"AUTO","AUTO"===r&&"AUTO"===o||"zh-CHS"===r||"zh-CHS"===o?_({method:"post",url:P,type:"form",body:Object.assign(s(n),{i:n,from:r,to:o,smartresult:"dict",doctype:"json",version:"2.1",keyfrom:"fanyi.web",action:"FY_BY_REALTIME",typoResult:"true"}),headers:"undefined"==typeof window?{Referer:O}:void 0}).then(function(t){if(0!==t.errorCode)throw new R("API_SERVER_ERROR","有道翻译接口出错了");var e=t.type.split("2"),r=e[0],o=e[1];r=N[r],o=N[o];var a=t.smartResult,u={raw:t,text:n,from:r,to:o,link:a?"https://dict.youdao.com/search?q="+encodeURIComponent(n)+"&keyfrom=fanyi.smartResult":"http://fanyi.youdao.com/translate?i="+encodeURIComponent(n)};if(a)try{u.dict=a.entries.filter(function(t){return t}).map(function(t){return t.trim()})}catch(t){}try{u.result=t.translateResult[0].map(function(t){return t.tgt.trim()})}catch(t){}return u}):Promise.reject(new R("UNSUPPORTED_LANG","有道翻译的源语种与目标语种中必须有一个是中文，或者两个都是 AUTO"))}function l(t){return f(a(t).text).then(function(t){var e=t.from;if(!e)throw new R("UNSUPPORTED_LANG","有道翻译不支持这个语种");return e})}function d(t){var e;e=null!==E?E:(E=I||"")||"";var n=["t","k"],r="&"+n.join("")+"=";n=e.split("."),e=Number(n[0])||0;for(var o=[],a=0,u=0;u<t.length;u++){var i=t.charCodeAt(u);128>i?o[a++]=i:(2048>i?o[a++]=i>>6|192:(55296==(64512&i)&&u+1<t.length&&56320==(64512&t.charCodeAt(u+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++u)),o[a++]=i>>18|240,o[a++]=i>>12&63|128):o[a++]=i>>12|224,o[a++]=i>>6&63|128),o[a++]=63&i|128)}for(t=e,a=0;a<o.length;a++)t+=o[a],t=p(t,"+-a^+6");return t=p(t,"+-3^+b+-f"),0>(t^=Number(n[1])||0)&&(t=2147483648+(2147483647&t)),t%=1e6,r+(t.toString()+".")+(t^e)}function p(t,e){for(var n=0;n<e.length-2;n+=3){var r=e.charAt(n+2),o="a"<=r?r.charCodeAt(0)-87:Number(r),a="+"==e.charAt(n+1)?t>>>o:t<<o;t="+"==e.charAt(n)?t+a&4294967295:t^a}return t}function h(t){var e=a(t),n=e.text,r=e.from,o=void 0===r?"auto":r,u=e.to,i=void 0===u?"zh-CN":u,c=e.com;return S(n,c).then(function(t){return _({url:"https://translate.google."+(c?"com":"cn")+"/translate_a/single",query:{q:n.toLowerCase(),sl:o,tl:i,tk:t,client:"t",hl:"zh-CN",dt:["at","bd","ex","ld","md","qca","rw","rm","ss","t"],ie:"UTF-8",oe:"UTF-8",otf:"2",ssel:"0",tsel:"0",kc:"1"}})}).then(function(t){var e=t[2],r={text:n,raw:t,from:e,to:i,link:"https://translate.google."+(c?"com":"cn")+"/#"+e+"/"+i+"/"+encodeURIComponent(n)};try{r.dict=t[1].map(function(t){return t[0]+"："+t[1].join("，")})}catch(t){}try{r.result=t[0].map(function(t){return t[0]}).filter(function(t){return t}).map(function(t){return t.trim()})}catch(t){}return r})}function m(t){return h(a(t).text).then(function(t){return t.from})}function y(t){return H[t]}function v(t){H[t.id]=t}function w(t,e){var n=a(e).api,r=void 0===n?z:n,o=y(r);return o?o[t](e):Promise.reject(new R("NO_THIS_API",'找不到 "'+r+'" 接口。'))}e=e&&e.hasOwnProperty("default")?e.default:e;var g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},R=function(t){function e(e,n){var r=t.call(this,n)||this;return r.code=e,r}return n(e,t),e}(Error),_=function(t){var e=new XMLHttpRequest,n=new URL(t.url);n.search=(n.search?"":"?")+u(t.query);var r=t.method,o=void 0===r?"get":r;e.open(o,n.toString());var a;if("post"===o)switch(t.type){case"form":e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a=u(t.body);break;case"json":default:e.setRequestHeader("Content-Type","application/json; charset=UTF-8"),a=JSON.stringify(t.body)}var i=t.headers;if(i)for(var c in i)e.setRequestHeader(c,i[c]);return new Promise(function(t,n){e.onload=function(){200!==e.status&&n(new R("API_SERVER_ERROR"));var r=e.responseText;try{t(JSON.parse(r))}catch(e){t(r)}},e.onerror=function(t){n(new R("NETWORK_ERROR",t.message))},e.send(a)})},b={en:"en",th:"th",ru:"ru",pt:"pt",el:"el",nl:"nl",pl:"pl",bg:"bul",et:"est",da:"dan",fi:"fin",cs:"cs",ro:"rom",sl:"slo",sv:"swe",hu:"hu",de:"de",it:"it","zh-CN":"zh","zh-TW":"cht","zh-HK":"yue",ja:"jp",ko:"kor",es:"spa",fr:"fra",ar:"ara"},U=r(b),x="https://fanyi.baidu.com",C={id:"baidu",translate:function(t){var e=a(t),n=e.from,r=e.to,u=e.text;return new Promise(function(t,e){n?t(n):i(u).then(t,e)}).then(function(t){return _({url:x+"/v2transapi",type:"form",method:"post",body:{from:t&&b[t]||"auto",to:r&&b[r]||"zh",query:u,transtype:"hash",simple_means_flag:3}}).then(function(t){var e=t.trans_result,n=o(e,"from","auto"),r=o(e,"to","auto"),a={text:u,raw:t,link:x+"/#"+n+"/"+r+"/"+encodeURIComponent(u),from:U[n],to:U[r]},i=o(t,["dict_result","simple_means","symbols","0"]);if(i){var s=[],f=i.ph_am,l=i.ph_en;f&&s.push({name:"美",ttsURI:c(u,"en"),value:f}),l&&s.push({name:"英",ttsURI:c(u,"en-GB"),value:l}),s.length&&(a.phonetic=s);try{a.dict=i.parts.map(function(t){return t.part+" "+t.means.join("；")})}catch(t){}}try{a.result=e.data.map(function(t){return t.dst})}catch(t){}return a})})},detect:i,audio:function(t){var e=a(t),n=e.text,r=e.from;return new Promise(function(t,e){r?t(r):i(n).then(t,e)}).then(function(t){var e;return e="en-GB"===t?"uk":b[t],c(n,e)})}},O="https://fanyi.youdao.com",P=O+"/translate_o?smartresult=dict&smartresult=rule",T={en:"en",ru:"ru",pt:"pt",es:"es","zh-CN":"zh-CHS",ja:"ja",ko:"ko",fr:"fr"},A="fanyideskweb",j="rY0D^0'nM0}g5Mm1z%1G4",N=r(T),k={id:"youdao",translate:f,detect:l,audio:function(t){var e=a(t),n=e.text,r=e.from;return new Promise(function(t,e){r?t(r):l(n).then(t,e)}).then(function(t){return"https://dict.youdao.com/dictvoice?audio="+encodeURIComponent(n)+"&le="+T[t]})}},I="",E=null,S=function(t,e){return new Promise(function(t,n){var r=Math.floor(Date.now()/36e5);Number(I.split(".")[0])===r?t():_({url:"https://translate.google."+(e?"com":"cn")}).then(function(e){var n=e.match(/TKK=eval\('\(\(function\(\){(.*?)}\)\(\)\)'\);/);if(n){var r=n[1].replace(/\\x3d/g,"=").replace(/\\x27/g,"'");try{I=new Function(r)()}catch(t){}}t()},n)}).then(function(){return d(t).replace("&tk=","")})},q={id:"google",translate:h,detect:m,audio:function(t){var e=a(t),n=e.text,r=e.from,o=e.com;return Promise.all([new Promise(function(t,e){r?t(r):m(n).then(t,e)}),S(n,o)]).then(function(t){var e=t[0],r=t[1];return"https://translate.google."+(o?"com":"cn")+"/translate_tts?ie=UTF-8&q="+encodeURIComponent(n)+"&tl="+e+"&total=1&idx=0&textlen="+n.length+"&tk="+r+"&client=t"})}},z="google",H={};v(C),v(k),v(q),t.translate=function(t){return w("translate",t)},t.detect=function(t){return w("detect",t)},t.audio=function(t){return w("audio",t)},Object.defineProperty(t,"__esModule",{value:!0})});